"use strict";var StopSlopContent=(()=>{var L=class{observeItems(e){let i=0,r=0,s=20,l=new WeakSet,o=null,c=300,n=()=>{let p=this.getCurrentItems(),m=p.filter(a=>!l.has(a)),g=p.length!==i;p.length>0&&(m.length>0||r===0)&&(o!==null&&clearTimeout(o),o=window.setTimeout(()=>{p.forEach(a=>l.add(a)),i=p.length;try{e(p)}catch(a){console.error("[Slop-Stop] Error in callback:",a)}o=null},c)),this.getPlatformName()==="linkedin"&&r<s&&(r++,setTimeout(n,500))},d=new MutationObserver(()=>{n()});d.observe(document.body,{childList:!0,subtree:!0});let h=this.getCurrentItems();return h.length>0?(h.forEach(p=>l.add(p)),i=h.length,e(h)):this.getPlatformName()==="linkedin"&&setTimeout(n,1e3),()=>d.disconnect()}getCurrentItems(){let e=this.getItemSelector();return Array.from(document.querySelectorAll(e))}createGhostContainer(e){let i=e.cloneNode(!0);i.style.visibility="hidden",i.style.pointerEvents="none";let r=document.createElement("div");r.style.position="absolute",r.style.top="0",r.style.left="0",r.style.width="100%",r.style.height="100%",r.style.zIndex="9999",r.setAttribute("data-slop-overlay","true");let s=e.getBoundingClientRect();r.style.width=`${s.width}px`,r.style.height=`${s.height}px`;let l=document.createElement("div");return l.style.position="relative",l.style.width=`${s.width}px`,l.style.height=`${s.height}px`,l.appendChild(i),l.appendChild(r),l}};var w={twitter:["twitter.com","x.com"],youtube:["youtube.com"],linkedin:["linkedin.com"],website:[]};var F=class extends L{getPlatformName(){return"twitter"}canHandleUrl(e){let i=new URL(e).hostname.toLowerCase();return w.twitter.some(r=>i.includes(r))}getItemSelector(){return'article[data-testid="tweet"]'}getItemId(e){let i=e.getAttribute("data-tweet-id");if(i)return i;let r=e.querySelector('a[href*="/status/"]');if(r){let l=r.href.match(/\/status\/(\d+)/);if(l)return l[1]}let s=e.getAttribute("aria-labelledby");return s||null}createGhostContainer(e){let i=window.getComputedStyle(e);i.position==="static"&&(e.style.position="relative"),e.style.visibility="visible",e.style.opacity="1";let r=e.offsetHeight||e.getBoundingClientRect().height;r>0&&(e.style.minHeight=`${r}px`),Array.from(e.children).forEach(c=>{c.getAttribute("data-slop-overlay")!=="true"&&(c.style.visibility="hidden",c.style.pointerEvents="none")}),e.querySelectorAll("img, video, svg").forEach(c=>{c.style.visibility="hidden",c.style.pointerEvents="none"}),e.style.pointerEvents="none";let o=document.createElement("div");return o.style.position="absolute",o.style.top="0",o.style.left="0",o.style.right="0",o.style.bottom="0",o.style.width="100%",o.style.height="100%",r>0&&(o.style.minHeight=`${r}px`),o.style.borderRadius=i.borderRadius||"16px",o.style.zIndex="999999",o.style.opacity="1",o.style.visibility="visible",o.style.display="flex",o.style.pointerEvents="auto",o.style.overflow="hidden",o.setAttribute("data-slop-overlay","true"),e.appendChild(o),o}};var J=class extends L{getPlatformName(){return"youtube"}canHandleUrl(e){let i=new URL(e).hostname.toLowerCase();return w.youtube.some(r=>i.includes(r))}getItemSelector(){return"ytd-rich-item-renderer, ytd-video-renderer"}getItemId(e){let i=e.getAttribute("data-video-id");if(i)return i;let r=e.querySelector('a[href*="/watch?v="]');if(r){let o=new URL(r.href).searchParams.get("v");if(o)return o}let s=e.querySelector('a[href*="/shorts/"]');if(s){let l=s.href.match(/\/shorts\/([^/?]+)/);if(l)return l[1]}return null}createGhostContainer(e){window.getComputedStyle(e).position==="static"&&(e.style.position="relative"),e.style.visibility="visible",e.style.opacity="1";let r=e.offsetHeight||e.getBoundingClientRect().height;r>0&&(e.style.minHeight=`${r}px`);let s=this.getItemId(e);Array.from(e.children).forEach(h=>{h.getAttribute("data-slop-overlay")!=="true"&&(h.style.visibility="hidden",h.style.pointerEvents="none")}),e.querySelectorAll("img, yt-img-shadow img, yt-image img").forEach(h=>{h.style.visibility="hidden",h.style.pointerEvents="none"}),e.querySelectorAll("video, ytd-thumbnail video").forEach(h=>{h.style.visibility="hidden",h.style.pointerEvents="none"}),e.querySelectorAll('[style*="background-image"]').forEach(h=>{let p=h;p.style.backgroundImage="none"}),e.style.pointerEvents="none";let d=document.createElement("div");return d.style.position="absolute",d.style.top="0",d.style.left="0",d.style.right="0",d.style.bottom="0",d.style.width="100%",d.style.height="100%",r>0&&(d.style.minHeight=`${r}px`),d.style.zIndex="99999",d.style.opacity="1",d.style.display="flex",d.style.visibility="visible",d.style.pointerEvents="auto",d.style.overflow="hidden",d.setAttribute("data-slop-overlay","true"),d.setAttribute("data-video-id",s||""),e.appendChild(d),d}};var $=class extends L{getPlatformName(){return"linkedin"}canHandleUrl(e){let i=new URL(e).hostname.toLowerCase();return w.linkedin.some(r=>i.includes(r))}getItemSelector(){return'[role="article"], [role="region"][aria-label*="Post"], [role="region"][aria-label*="post"], div[data-test-id*="activity"], div[data-test-id*="feed"], section[class*="update"], section[class*="post"]'}getCurrentItems(){let e=null;e=document.querySelector("main#workspace"),e||(e=Array.from(document.querySelectorAll("main")).find(u=>u.id==="workspace")||null),e||(e=document.querySelector("main")),e||(e=document.body,console.warn("[Slop-Stop] main#workspace not found, using document.body as fallback"));let i={location:"linkedin-adapter.ts:26",message:"Main feed container search",data:{mainFeedFound:!!e,mainFeedTag:e?.tagName,mainFeedId:e?.id,mainFeedClassName:e?.className?.substring(0,100),allMainsCount:document.querySelectorAll("main").length,bodyChildrenCount:document.body.children.length,url:window.location.href},timestamp:Date.now(),sessionId:"debug-session",runId:"run4",hypothesisId:"D"};if(fetch("http://127.0.0.1:7243/ingest/b2719b1f-0fda-42ef-a1bf-85265994e0a0",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}).catch(()=>{}),!e)return console.warn("[Slop-Stop] Could not find main feed container"),[];let r=null,s=[".scaffold-finite-scroll__content",'[class*="scaffold-finite-scroll"]','div[class*="scroll"]'];for(let a of s){let u=e.querySelector(a);if(u){r=u,console.log(`[Slop-Stop] Found scroll container using selector: ${a}`);break}}if(!r){let a=Array.from(e.querySelectorAll("div"));for(let u of a){let I=u.className||"",T=u.getAttribute("style")||"";if((I.includes("scroll")||I.includes("feed")||T.includes("overflow")&&T.includes("auto"))&&u.children.length>5){r=u,console.log(`[Slop-Stop] Found scroll container by deep search: ${I.substring(0,50)}`);break}}}r||(r=e,console.log("[Slop-Stop] Using main#workspace as scroll container"));let l=[],o=new Set,c=Array.from(r.querySelectorAll("div, section, article"));console.log(`[Slop-Stop] Found ${c.length} candidate elements in scroll container`);let n=c.map(a=>({element:a,size:(a.textContent?.length||0)+a.children.length*100+a.querySelectorAll('button, [role="button"]').length*50})).sort((a,u)=>u.size-a.size).map(a=>a.element),d={location:"linkedin-adapter.ts:50",message:"Starting structure-based detection",data:{candidateElementsCount:c.length,sortedCandidatesCount:n.length,scrollContainerFound:!!r,scrollContainerTag:r?.tagName},timestamp:Date.now(),sessionId:"debug-session",runId:"run4",hypothesisId:"D"};fetch("http://127.0.0.1:7243/ingest/b2719b1f-0fda-42ef-a1bf-85265994e0a0",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)}).catch(()=>{});for(let a of n){if(o.has(a)||a===r||a===e||a.tagName==="MAIN")continue;let u=!1;for(let S of l)if(S.contains(a)){u=!0;break}if(u){o.add(a);continue}let I=a.textContent?.length||0,T=a.querySelectorAll('button, [role="button"]'),E=T.length,v=a.querySelectorAll("img"),b=v.length,K=a.children.length,D=Array.from(T).some(S=>{let f=(S.textContent||"").toLowerCase();return f.includes("like")||f.includes("comentar")||f.includes("comment")||f.includes("share")||f.includes("compartir")||f.includes("recomendar")}),H=Array.from(v).some(S=>{let f=(S.getAttribute("alt")||"").toLowerCase();return f.includes("profile")||f.includes("avatar")||f.includes("member")}),z=a.getBoundingClientRect(),B=z.height>=150,_=!1,P=a.parentElement,M=0;for(;P&&M<5;){if(P===r){_=M<=2;break}P=P.parentElement,M++}if(I>=100&&I<=5e3&&D&&(K>=3||b>0)&&B&&_&&(H||E>=3)&&(a.tagName==="DIV"||a.tagName==="SECTION"||a.tagName==="ARTICLE")){let S=[];for(let x of l)a.contains(x)&&S.push(x);for(let x of S){let R=l.indexOf(x);R!==-1&&(l.splice(R,1),o.delete(x))}o.add(a);let f=a.querySelectorAll("div, section, article");f.forEach(x=>o.add(x)),l.push(a),console.log("[Slop-Stop] Found post by structure:",{tagName:a.tagName,className:a.className?.substring(0,100),textLength:I,buttonsCount:E,imagesCount:b,hasEngagementButtons:D,hasProfileImage:H,descendantsMarked:f.length});let j={location:"linkedin-adapter.ts:110",message:"Found post by structure",data:{tagName:a.tagName,className:a.className?.substring(0,100),textLength:I,buttonsCount:E,imagesCount:b,hasEngagementButtons:D,hasProfileImage:H,hasMinimumHeight:B,isTopLevel:_,depth:M,height:z.height,descendantsMarked:f.length,nestedPostsRemoved:S.length},timestamp:Date.now(),sessionId:"debug-session",runId:"run5",hypothesisId:"D"};fetch("http://127.0.0.1:7243/ingest/b2719b1f-0fda-42ef-a1bf-85265994e0a0",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(j)}).catch(()=>{})}}if(l.length>0){console.log(`[Slop-Stop] Found ${l.length} posts using structure-based detection`);let a={location:"linkedin-adapter.ts:125",message:"getCurrentItems returning (structure-based)",data:{itemsCount:l.length,items:l.slice(0,5).map(u=>({tagName:u.tagName,className:u.className?.substring(0,50),id:u.id?.substring(0,30),textLength:u.textContent?.length,buttonsCount:u.querySelectorAll('button, [role="button"]').length,imagesCount:u.querySelectorAll("img").length,childrenCount:u.children.length}))},timestamp:Date.now(),sessionId:"debug-session",runId:"run4",hypothesisId:"D"};return fetch("http://127.0.0.1:7243/ingest/b2719b1f-0fda-42ef-a1bf-85265994e0a0",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).catch(()=>{}),l}console.log("[Slop-Stop] No posts found with structure-based detection, using aggressive fallback...");let h={location:"linkedin-adapter.ts:135",message:"Starting aggressive fallback",data:{timestamp:Date.now()},sessionId:"debug-session",runId:"run3",hypothesisId:"P"};fetch("http://127.0.0.1:7243/ingest/b2719b1f-0fda-42ef-a1bf-85265994e0a0",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)}).catch(()=>{});let p=Array.from(e.querySelectorAll("*")).slice(0,1e3),m=[];p.forEach(a=>{let u=a;if(u.tagName==="MAIN"||u.id==="workspace")return;let T=(u.textContent||"").length,E=u.querySelectorAll('button, [role="button"]'),v=E.length,b=u.querySelectorAll("img"),K=b.length,D=Array.from(E).some(S=>{let f=(S.textContent||"").toLowerCase();return f.includes("like")||f.includes("comentar")||f.includes("comment")||f.includes("share")||f.includes("compartir")||f.includes("recomendar")||f.includes("follow")||f.includes("connect")}),H=Array.from(b).some(S=>{let f=(S.getAttribute("alt")||"").toLowerCase();return f.includes("profile")||f.includes("avatar")||f.includes("member")}),B=u.getBoundingClientRect().height>=150,_=!1,P=u.parentElement,M=0;for(;P&&M<5;){if(P===e||P===r){_=M<=2;break}P=P.parentElement,M++}if(T>=100&&T<=5e3&&v>=3&&D&&(H||v>=4)&&(K>0||u.children.length>=3)&&B&&_&&(u.tagName==="DIV"||u.tagName==="SECTION"||u.tagName==="ARTICLE")){let S=u,f=u.parentElement,j=0;for(;f&&j<5&&f!==e;){let R=(f.textContent||"").length;if(f.querySelectorAll('button, [role="button"]').length>=2&&R>=50&&R<=3e3)S=f;else if(R>3e3)break;f=f.parentElement,j++}if(S.tagName==="MAIN"||S.id==="workspace")return;let x=S.textContent?.length||0;if(x<50||x>3e3)return;m.push({element:S,reason:D?"hasEngagementButtons":H?"hasProfileImage":"isSubstantialContainer",data:{tagName:S.tagName,className:S.className?.substring(0,150)||"",textLength:x,buttonsCount:S.querySelectorAll('button, [role="button"]').length,imagesCount:S.querySelectorAll("img").length}})}});let g=Array.from(new Map(m.map(a=>[a.element,a])).values());console.log(`[Slop-Stop] Found ${g.length} potential posts by aggressive fallback`),g.forEach(({element:a})=>{o.has(a)||(o.add(a),l.push(a))}),console.log(`[Slop-Stop] Total unique LinkedIn items found: ${l.length}`);let y={location:"linkedin-adapter.ts:200",message:"getCurrentItems returning (aggressive fallback)",data:{itemsCount:l.length,items:l.slice(0,5).map(a=>({tagName:a.tagName,className:a.className?.substring(0,50),id:a.id?.substring(0,30),textLength:a.textContent?.length,buttonsCount:a.querySelectorAll('button, [role="button"]').length,imagesCount:a.querySelectorAll("img").length,childrenCount:a.children.length}))},timestamp:Date.now(),sessionId:"debug-session",runId:"run4",hypothesisId:"D"};return fetch("http://127.0.0.1:7243/ingest/b2719b1f-0fda-42ef-a1bf-85265994e0a0",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(y)}).catch(()=>{}),l}getItemId(e){let i=e.getAttribute("data-id");if(i?.startsWith("urn:li:activity:")){let m=i.match(/urn:li:activity:(\d+)/);return m?m[1]:i}let r=e.getAttribute("data-urn");if(!r&&!i){let m=e.parentElement,g=0;for(;m&&g<10;){if(i=m.getAttribute("data-id"),i?.startsWith("urn:li:activity:")){let y=i.match(/urn:li:activity:(\d+)/);return y?y[1]:i}if(r=m.getAttribute("data-urn"),r?.startsWith("urn:li:activity:"))break;m=m.parentElement,g++}}if(r?.startsWith("urn:li:activity:")){let m=r.match(/urn:li:activity:(\d+)/);return m?m[1]:r}let s=e.getAttribute("data-activity-id");if(!s){let m=e.parentElement,g=0;for(;m&&g<10&&(s=m.getAttribute("data-activity-id"),!s);)m=m.parentElement,g++}if(s)return s;let l=e.textContent?.substring(0,300)||"",o=Array.from(e.parentElement?.children||[]).indexOf(e),c=e.className||"",n=e.id||"",d=[];Array.from(e.attributes).forEach(m=>{m.name.startsWith("data-")&&m.value&&d.push(`${m.name}=${m.value.substring(0,50)}`)});let h=`${l}-${c}-${n}-${o}-${d.join("-")}`,p=0;for(let m=0;m<h.length;m++){let g=h.charCodeAt(m);p=(p<<5)-p+g,p=p&p}return`linkedin-${o}-${Math.abs(p)}`}createGhostContainer(e){window.getComputedStyle(e).position==="static"&&(e.style.position="relative"),e.style.visibility="visible",e.style.opacity="1";let r=e.offsetHeight||e.getBoundingClientRect().height;r>0&&(e.style.minHeight=`${r}px`),Array.from(e.children).forEach(c=>{c.getAttribute("data-slop-overlay")!=="true"&&(c.style.visibility="hidden",c.style.pointerEvents="none")}),e.querySelectorAll("img, video, svg").forEach(c=>{c.style.visibility="hidden",c.style.pointerEvents="none"}),e.style.pointerEvents="none";let o=document.createElement("div");return o.style.position="absolute",o.style.top="0",o.style.left="0",o.style.right="0",o.style.bottom="0",o.style.width="100%",o.style.height="100%",r>0&&(o.style.minHeight=`${r}px`),o.style.zIndex="99999",o.style.opacity="1",o.style.visibility="visible",o.style.display="flex",o.style.pointerEvents="auto",o.style.overflow="hidden",o.setAttribute("data-slop-overlay","true"),e.appendChild(o),o}};var G=class extends L{getPlatformName(){return"website"}canHandleUrl(e){let i=new URL(e).hostname.toLowerCase();return![...w.twitter,...w.youtube,...w.linkedin].some(s=>i.includes(s))}getItemSelector(){return"body"}getItemId(e){return window.location.href}createGhostContainer(e){let i=document.createElement("div");return i.style.position="fixed",i.style.top="0",i.style.left="0",i.style.width="100%",i.style.height="100%",i.style.zIndex="99999",i.setAttribute("data-slop-overlay","true"),document.body.appendChild(i),i}};var X=t=>{let e=new URL(t).hostname.toLowerCase();for(let[i,r]of Object.entries(w))if(r.some(s=>e.includes(s)))return i;return"website"};var tt=t=>{let e=document.createElement("div");e.className="slop-curtain",e.setAttribute("data-slop-curtain","true");let i=document.createElement("div");i.className="slop-curtain-content";let r=document.createElement("h2");r.className="slop-curtain-headline",r.textContent="Slop content flagged by the community";let s=document.createElement("p");s.className="slop-curtain-subtext",s.textContent="Flagged as low-quality slop by Human Resistance curators.";let l=document.createElement("div");l.className="slop-curtain-counter",l.textContent=`${t.reportCount} Community Report${t.reportCount!==1?"s":""}`,i.appendChild(r),i.appendChild(s),i.appendChild(l);let o=document.createElement("button");o.className="slop-curtain-show-button",o.textContent="Show",o.setAttribute("aria-label","Show slop content"),o.setAttribute("tabindex","0"),o.style.pointerEvents="auto",o.style.zIndex="10001";let c=()=>{e.style.transition="opacity 0.3s ease-out",e.style.opacity="0",setTimeout(()=>{t.onShow()},300)};return o.addEventListener("click",n=>{n.preventDefault(),n.stopPropagation(),n.stopImmediatePropagation(),c()}),o.addEventListener("keydown",n=>{(n.key==="Enter"||n.key===" ")&&(n.preventDefault(),n.stopPropagation(),c())}),e.appendChild(i),e.appendChild(o),e};var W=t=>{let e=document.createElement("div");e.className="slop-confirmation-overlay",e.setAttribute("data-slop-modal","true");let i=document.createElement("div");i.className="slop-confirmation-modal";let r=document.createElement("p");r.className="slop-confirmation-message",r.textContent=t.message;let s=document.createElement("div");s.className="slop-confirmation-buttons";let l=document.createElement("button");l.className="slop-confirmation-cancel",l.textContent=t.cancelText||"Cancel",l.setAttribute("aria-label","Cancel"),l.setAttribute("tabindex","0"),l.addEventListener("click",t.onCancel),l.addEventListener("keydown",n=>{n.key==="Escape"&&(n.preventDefault(),t.onCancel())});let o=document.createElement("button");o.className="slop-confirmation-confirm",o.textContent=t.confirmText||"Confirm",o.setAttribute("aria-label","Confirm"),o.setAttribute("tabindex","0"),o.addEventListener("click",t.onConfirm),o.addEventListener("keydown",n=>{n.key==="Enter"&&(n.preventDefault(),t.onConfirm())}),s.appendChild(l),s.appendChild(o),i.appendChild(r),i.appendChild(s),e.appendChild(i);let c=n=>{n.key==="Escape"?t.onCancel():n.key==="Enter"&&n.target===e&&t.onConfirm()};return e.addEventListener("keydown",c),e.addEventListener("click",n=>{n.target===e&&t.onCancel()}),setTimeout(()=>{o.focus()},0),e},q=t=>{t.remove()};var k={isTrashMode:!1,currentModal:null},et=(t,e,i)=>{let r=async s=>{s.altKey&&s.key==="s"&&!s.ctrlKey&&!s.metaKey?(s.preventDefault(),at(t,e)):s.altKey&&s.key==="u"&&!s.ctrlKey&&!s.metaKey&&(s.preventDefault(),await it(i))};return document.addEventListener("keydown",r,!0),()=>{document.removeEventListener("keydown",r,!0),U()}},at=(t,e)=>{k.isTrashMode?U():rt(t,e)},rt=(t,e)=>{k.isTrashMode=!0,document.body.classList.add("slop-trash-cursor");let i=async s=>{let l=s.target,o={location:"hotkeys.ts:57",message:"handleClick called",data:{targetTagName:l.tagName,targetClassName:l.className?.substring(0,50),targetId:l.id?.substring(0,30),platform:t.getPlatformName(),timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"A"}};fetch("http://127.0.0.1:7243/ingest/b2719b1f-0fda-42ef-a1bf-85265994e0a0",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}).catch(()=>{});let c=t.getItemSelector(),n=null;if(t.getPlatformName()==="linkedin"){let d=l,h=0;for(;d&&h<20;){if(d.tagName==="MAIN"||d.id==="workspace"){d=d.parentElement,h++;continue}let p=d.textContent?.length||0,m=d.querySelectorAll('button, [role="button"]'),g=m.length,y=d.querySelectorAll("img"),a=y.length,u=d.children.length,I=Array.from(m).some(v=>{let b=(v.textContent||"").toLowerCase();return b.includes("like")||b.includes("comentar")||b.includes("comment")||b.includes("share")||b.includes("compartir")||b.includes("recomendar")||b.includes("follow")||b.includes("connect")}),T=Array.from(y).some(v=>{let b=(v.getAttribute("alt")||"").toLowerCase();return b.includes("profile")||b.includes("avatar")||b.includes("member")});if(p>=50&&p<=3e3&&(g>=1||a>0||u>=2)&&(I||T||a>0||g>=2)&&(d.tagName==="DIV"||d.tagName==="SECTION"||d.tagName==="ARTICLE")){n=d;let v={location:"hotkeys.ts:95",message:"Found item by structure",data:{itemTagName:n.tagName,itemClassName:n.className?.substring(0,50),itemId:n.id?.substring(0,30),textLength:p,buttonsCount:g,hasEngagementButtons:I,depth:h,timestamp:Date.now(),sessionId:"debug-session",runId:"run3",hypothesisId:"Q"}};fetch("http://127.0.0.1:7243/ingest/b2719b1f-0fda-42ef-a1bf-85265994e0a0",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(v)}).catch(()=>{});break}d=d.parentElement,h++}if(!n){let p=t.getCurrentItems(),m={location:"hotkeys.ts:130",message:"Trying getCurrentItems fallback",data:{allItemsCount:p.length,timestamp:Date.now(),sessionId:"debug-session",runId:"run3",hypothesisId:"R"}};fetch("http://127.0.0.1:7243/ingest/b2719b1f-0fda-42ef-a1bf-85265994e0a0",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(m)}).catch(()=>{});for(let g of p)if(!(g.tagName==="MAIN"||g.id==="workspace")&&g.contains(l)){n=g;let y={location:"hotkeys.ts:145",message:"Found item by getCurrentItems",data:{itemTagName:n.tagName,itemClassName:n.className?.substring(0,50),itemId:n.id?.substring(0,30),timestamp:Date.now(),sessionId:"debug-session",runId:"run3",hypothesisId:"R"}};fetch("http://127.0.0.1:7243/ingest/b2719b1f-0fda-42ef-a1bf-85265994e0a0",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(y)}).catch(()=>{});break}}}else if(n=l.closest(c),!n&&c.includes(",")){let d=c.split(",").map(h=>h.trim());for(let h of d)if(n=l.closest(h),n)break}if(n){s.preventDefault(),s.stopPropagation(),s.stopImmediatePropagation();let d=t.getItemId(n),h={location:"hotkeys.ts:173",message:"Item found, checking itemId",data:{itemFound:!0,itemId:d,itemTagName:n.tagName,itemClassName:n.className?.substring(0,50),itemIdAttr:n.id?.substring(0,30),targetTagName:l.tagName,timestamp:Date.now(),sessionId:"debug-session",runId:"run4",hypothesisId:"E"}};if(fetch("http://127.0.0.1:7243/ingest/b2719b1f-0fda-42ef-a1bf-85265994e0a0",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)}).catch(()=>{}),!d){let g={location:"hotkeys.ts:181",message:"No itemId found for clicked item",data:{itemTagName:n.tagName,itemClassName:n.className?.substring(0,50),targetTagName:l.tagName,timestamp:Date.now(),sessionId:"debug-session",runId:"run4",hypothesisId:"E"}};fetch("http://127.0.0.1:7243/ingest/b2719b1f-0fda-42ef-a1bf-85265994e0a0",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(g)}).catch(()=>{});return}let p={location:"hotkeys.ts:186",message:"Creating confirmation modal",data:{itemId:d,itemTagName:n.tagName,timestamp:Date.now(),sessionId:"debug-session",runId:"run4",hypothesisId:"E"}};fetch("http://127.0.0.1:7243/ingest/b2719b1f-0fda-42ef-a1bf-85265994e0a0",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)}).catch(()=>{});let m=W({message:"Mark as SLOP?",onConfirm:async()=>{q(m),await e(d,n),U()},onCancel:()=>{q(m),U()}});k.currentModal=m,document.body.appendChild(m)}else{let d={location:"hotkeys.ts:201",message:"No item found for click",data:{targetTagName:l.tagName,targetClassName:l.className?.substring(0,50),targetId:l.id?.substring(0,30),platform:t.getPlatformName(),timestamp:Date.now(),sessionId:"debug-session",runId:"run4",hypothesisId:"E"}};fetch("http://127.0.0.1:7243/ingest/b2719b1f-0fda-42ef-a1bf-85265994e0a0",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)}).catch(()=>{})}};document.addEventListener("click",i,!0);let r=()=>{document.removeEventListener("click",i,!0)};window.__slopTrashCleanup=r},U=()=>{k.isTrashMode=!1,document.body.classList.remove("slop-trash-cursor"),k.currentModal&&(q(k.currentModal),k.currentModal=null);let t=window.__slopTrashCleanup;t&&(t(),delete window.__slopTrashCleanup)},it=async t=>{let e=W({message:"Mark this website as SLOP?",onConfirm:async()=>{q(e),(await t()).shouldBlock&&lt()},onCancel:()=>{q(e)}});k.currentModal=e,document.body.appendChild(e)},lt=()=>{let t=document.createElement("div");t.className="slop-website-block-modal";let e=document.createElement("div");e.className="slop-website-block-content";let i=document.createElement("h2");i.className="slop-website-block-title",i.textContent="Website Marked as Slop";let r=document.createElement("p");r.className="slop-website-block-message",r.textContent="This website has been flagged by the community as containing slop content. You can return to safety or continue anyway.";let s=document.createElement("div");s.className="slop-website-block-buttons";let l=document.createElement("button");l.className="slop-website-block-button slop-website-block-return",l.textContent="Return",l.addEventListener("click",()=>{window.history.back(),t.remove()});let o=document.createElement("button");o.className="slop-website-block-button slop-website-block-continue",o.textContent="Continue Anyway",o.addEventListener("click",()=>{t.remove()}),s.appendChild(l),s.appendChild(o),e.appendChild(i),e.appendChild(r),e.appendChild(s),t.appendChild(e),document.body.appendChild(t)};var C=new Map,V=new Set,A=null,N=!0,ot=t=>{for(let e of C.values())if(e.itemId===t&&e.overlay&&e.overlay.parentNode!==null)return e;return null},Z=t=>t&&(t.message?.includes("Extension context invalidated")||t.message?.includes("message port closed")||t.message?.includes("Receiving end does not exist"))||!1,O=()=>{N&&(N=!1,console.warn("[Slop-Stop] Extension context invalidated, stopping evaluation"),C.forEach(t=>{t.overlay&&(t.overlay.__slopCleanup&&t.overlay.__slopCleanup(),t.overlay.parentNode&&t.overlay.parentNode.removeChild(t.overlay)),t.element&&(t.element.style.opacity="",t.element.style.visibility="",t.element.style.pointerEvents="")}),C.clear(),document.querySelectorAll("[data-slop-trash-icon]").forEach(t=>{t.remove()}),document.querySelectorAll("[data-slop-overlay]").forEach(t=>{t.__slopCleanup&&t.__slopCleanup(),t.remove()}))},ct=()=>{let t=window.location.href;if(A&&A.canHandleUrl(t))return A;switch(X(t)){case"twitter":A=new F;break;case"youtube":A=new J;break;case"linkedin":A=new $;break;default:A=new G}return A},dt=async(t,e)=>N?new Promise(i=>{try{chrome.runtime.sendMessage({type:"GET_SLOP_STATUS",payload:{itemId:t,platform:e}},r=>{if(chrome.runtime.lastError){if(Z(chrome.runtime.lastError))O();else{let s=chrome.runtime.lastError.message||"Unknown error";console.error("[Slop-Stop] Error checking slop status:",s)}i({isSlop:!1,reportCount:0});return}i(r||{isSlop:!1,reportCount:0})})}catch(r){let s=r instanceof Error?r.message:String(r);s.includes("Extension context invalidated")?O():console.error("[Slop-Stop] Exception checking slop status:",s),i({isSlop:!1,reportCount:0})}}):{isSlop:!1,reportCount:0},Q=async(t,e)=>N?new Promise((i,r)=>{try{console.log("[Slop-Stop] reportSlop: sending message",{itemId:t,platform:e}),chrome.runtime.sendMessage({type:"REPORT_SLOP",payload:{itemId:t,platform:e}},s=>{if(chrome.runtime.lastError){console.error("[Slop-Stop] reportSlop: chrome.runtime.lastError",chrome.runtime.lastError),Z(chrome.runtime.lastError)?(O(),i()):r(chrome.runtime.lastError);return}if(console.log("[Slop-Stop] reportSlop: received response",s),s&&s.error){console.error("[Slop-Stop] reportSlop: response contains error",s.error),r(new Error(s.error));return}if(s&&s.success===!1){console.error("[Slop-Stop] reportSlop: response.success is false",s),r(new Error(s.error||"Report failed"));return}console.log("[Slop-Stop] reportSlop: success",s),i()})}catch(s){console.error("[Slop-Stop] reportSlop: exception",s),s instanceof Error&&s.message.includes("Extension context invalidated")?(O(),i()):r(s)}}):(console.warn("[Slop-Stop] reportSlop: context invalidated, returning"),Promise.resolve()),mt=async()=>N?new Promise(t=>{try{chrome.runtime.sendMessage({type:"REPORT_WEBSITE",payload:{url:window.location.href}},e=>{if(chrome.runtime.lastError){Z(chrome.runtime.lastError)?O():console.error("Error reporting website:",chrome.runtime.lastError),t({shouldBlock:!1});return}t(e||{shouldBlock:!1})})}catch(e){e instanceof Error&&e.message.includes("Extension context invalidated")&&O(),t({shouldBlock:!1})}}):{shouldBlock:!1},Y=async(t,e,i=!1)=>{let r={location:"content-main.ts:230",message:"processItem called",data:{forceOverlay:i,elementTagName:t.tagName,elementClassName:t.className?.substring(0,50),elementId:t.id?.substring(0,30),isConnected:t.isConnected,timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"E"}};if(fetch("http://127.0.0.1:7243/ingest/b2719b1f-0fda-42ef-a1bf-85265994e0a0",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).catch(()=>{}),!t.isConnected)return;let s=e.getItemId(t),l={location:"content-main.ts:236",message:"Got itemId",data:{itemId:s,forceOverlay:i,timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"C"}};if(fetch("http://127.0.0.1:7243/ingest/b2719b1f-0fda-42ef-a1bf-85265994e0a0",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}).catch(()=>{}),!s)return;if(!i){let a=ot(s);if(a){a.element!==t&&t.isConnected&&(C.delete(a.element),C.set(t,a));return}}let o=C.get(t);if(o){if(o.overlay&&!i||o.isShowing&&!i)return;if(o.overlay&&i)o.overlay.__slopCleanup&&o.overlay.__slopCleanup(),o.overlay.parentNode&&o.overlay.parentNode.removeChild(o.overlay),C.delete(t);else if(o.isShowing)C.delete(t);else if(!i)return}let c=e.getPlatformName(),n=await dt(s,c),d={location:"content-main.ts:284",message:"Slop status checked",data:{itemId:s,isSlop:n.isSlop,forceOverlay:i,reportCount:n.reportCount,willCreateOverlay:n.isSlop||i,timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"A"}};if(fetch("http://127.0.0.1:7243/ingest/b2719b1f-0fda-42ef-a1bf-85265994e0a0",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)}).catch(()=>{}),!n.isSlop&&!i)return;let h=i&&n.reportCount===0?1:n.reportCount,p=e.createGhostContainer(t);p.__createdAt=Date.now(),p.style.pointerEvents="auto";let m=t.querySelector("[data-slop-trash-icon]");m&&m.parentElement===t&&(p.appendChild(m),m.style.zIndex="1000000");let g=tt({reportCount:h,onShow:()=>{let a=C.get(t);if(!a||a.isShowing)return;if(!t.isConnected){a.overlay&&a.overlay.parentNode&&a.overlay.parentNode.removeChild(a.overlay),C.delete(t);return}a.isShowing=!0,p.__slopCleanup&&p.__slopCleanup(),p.parentNode&&p.parentNode.removeChild(p),t.style.removeProperty("opacity"),t.style.removeProperty("pointer-events"),t.style.removeProperty("visibility"),t.style.removeProperty("min-height");let u=p.querySelector("[data-slop-trash-icon]");u&&u.parentElement===p&&(t.appendChild(u),u.style.zIndex="999999"),Array.from(t.children).forEach(v=>{v!==p&&v.getAttribute("data-slop-overlay")!=="true"&&(v.style.removeProperty("visibility"),v.style.removeProperty("pointer-events"))}),t.querySelectorAll("img, yt-img-shadow img, yt-image img, video, ytd-thumbnail video, svg").forEach(v=>{v.style.removeProperty("visibility"),v.style.removeProperty("pointer-events")});let E=window.getComputedStyle(t);t.style.position==="relative"&&E.position==="relative"&&(Array.from(C.values()).some(b=>b.overlay&&b.element===t&&b!==a)||t.style.removeProperty("position")),t.offsetHeight,a.overlay=null,t.style.pointerEvents=""},onReport:async()=>{try{await Q(s,c).catch(()=>{})}catch{}}});p.appendChild(g),p.style.display="flex",p.style.opacity="1",p.style.visibility="visible",C.set(t,{element:t,itemId:s,overlay:p,isShowing:!1});let y={location:"content-main.ts:411",message:"Overlay created and stored",data:{itemId:s,elementTagName:t.tagName,processedItemsCount:C.size,forceOverlay:i,timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"E"}};fetch("http://127.0.0.1:7243/ingest/b2719b1f-0fda-42ef-a1bf-85265994e0a0",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(y)}).catch(()=>{})},ut=(t,e)=>{if(t.querySelector("[data-slop-trash-icon]"))return;let i=t.tagName==="MAIN"||t.id==="workspace",r={location:"content-main.ts:440",message:"addTrashIconToItem called",data:{elementTagName:t.tagName,elementClassName:t.className?.substring(0,50),elementId:t.id?.substring(0,30),elementTextLength:t.textContent?.length,elementChildrenCount:t.children.length,isMainFeed:i,platform:e.getPlatformName(),timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"F"}};if(fetch("http://127.0.0.1:7243/ingest/b2719b1f-0fda-42ef-a1bf-85265994e0a0",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).catch(()=>{}),e.getPlatformName()==="linkedin"){if(t.tagName==="MAIN"||t.id==="workspace"){let g={location:"content-main.ts:448",message:"Skipping trash icon - main feed container",data:{elementTagName:t.tagName,elementId:t.id,timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"G"}};fetch("http://127.0.0.1:7243/ingest/b2719b1f-0fda-42ef-a1bf-85265994e0a0",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(g)}).catch(()=>{});return}let m=document.querySelector("main#workspace");if(m&&t.parentElement===m){let g=t.textContent?.length||0,y=t.querySelectorAll('button, [role="button"]').length,a=(t.children.length>=1||y>=1)&&(g>50||t.querySelector("img, video"));if(g>5e3&&y<2){let u={location:"content-main.ts:460",message:"Skipping trash icon - likely feed container",data:{elementTagName:t.tagName,elementId:t.id,textLength:g,hasSubstantialContent:a,buttons:y,isDirectChildOfMain:!0,timestamp:Date.now(),sessionId:"debug-session",runId:"run4",hypothesisId:"A"}};fetch("http://127.0.0.1:7243/ingest/b2719b1f-0fda-42ef-a1bf-85265994e0a0",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)}).catch(()=>{});return}if(!a&&g<50){let u={location:"content-main.ts:475",message:"Skipping trash icon - no substantial content",data:{elementTagName:t.tagName,elementId:t.id,textLength:g,childrenCount:t.children.length,buttons:y,isDirectChildOfMain:!0,timestamp:Date.now(),sessionId:"debug-session",runId:"run4",hypothesisId:"A"}};fetch("http://127.0.0.1:7243/ingest/b2719b1f-0fda-42ef-a1bf-85265994e0a0",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)}).catch(()=>{});return}}}let s=document.createElement("button");s.className="slop-item-trash-icon",s.setAttribute("data-slop-trash-icon","true"),s.setAttribute("aria-label","Report as slop"),s.setAttribute("tabindex","0"),s.innerHTML=`
    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M2 4h12M5 4V2a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2m-6 0v10a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1V4M6 7v6M10 7v6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
    </svg>
  `;let l=async m=>{m.preventDefault(),m.stopPropagation(),m.stopImmediatePropagation();let g={location:"content-main.ts:435",message:"Trash icon clicked",data:{elementTagName:t.tagName,elementClassName:t.className?.substring(0,50),elementId:t.id?.substring(0,30),timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"D"}};if(fetch("http://127.0.0.1:7243/ingest/b2719b1f-0fda-42ef-a1bf-85265994e0a0",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(g)}).catch(()=>{}),!N){console.warn("[Slop-Stop] trashIcon click: context invalidated");return}try{let y=e.getItemId(t),a={location:"content-main.ts:446",message:"Trash icon got itemId",data:{itemId:y,elementTagName:t.tagName,timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"C"}};if(fetch("http://127.0.0.1:7243/ingest/b2719b1f-0fda-42ef-a1bf-85265994e0a0",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).catch(()=>{}),y&&N)try{await Q(y,e.getPlatformName()),await Y(t,e,!0).catch(u=>{console.error("[Slop-Stop] trashIcon: processItem failed",u)})}catch(u){console.error("[Slop-Stop] trashIcon: reportSlop failed",u)}}catch(y){console.error("[Slop-Stop] trashIcon click: ERROR",y)}};s.addEventListener("click",l,!0),s.addEventListener("mousedown",m=>{m.preventDefault(),m.stopPropagation(),m.stopImmediatePropagation()},!0),s.style.cssText=`
    position: absolute;
    bottom: 0.5rem;
    right: 0.5rem;
    padding: 0.5rem;
    background: rgba(0, 0, 0, 0.6);
    color: #ffffff;
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 999999;
    opacity: 0;
    transition: opacity 0.2s, background-color 0.2s;
    pointer-events: auto !important;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
  `;let o=window.getComputedStyle(t);o.position==="static"&&(t.style.position="relative"),o.overflow==="hidden"&&(t.hasAttribute("data-slop-original-overflow")||t.setAttribute("data-slop-original-overflow",o.overflow),t.style.overflow="visible");let c=()=>{s.style.opacity="1"},n=()=>{s.style.opacity="0"};t.addEventListener("mouseenter",c),t.addEventListener("mouseleave",n),s.addEventListener("mouseenter",c),s.addEventListener("mouseleave",n),s.addEventListener("mouseenter",()=>{s.style.backgroundColor="rgba(255, 255, 255, 0.1)"}),s.addEventListener("mouseleave",()=>{s.style.backgroundColor="rgba(0, 0, 0, 0.6)"}),t.appendChild(s);let d=window.getComputedStyle(t),h=window.getComputedStyle(s),p={location:"content-main.ts:613",message:"Trash icon added successfully",data:{elementTagName:t.tagName,elementClassName:t.className?.substring(0,50),elementId:t.id?.substring(0,30),elementTextLength:t.textContent?.length,platform:e.getPlatformName(),elementPosition:d.position,elementOverflow:d.overflow,elementZIndex:d.zIndex,trashIconPosition:h.position,trashIconOpacity:h.opacity,trashIconVisibility:h.visibility,trashIconZIndex:h.zIndex,trashIconDisplay:h.display,trashIconInDOM:s.isConnected,timestamp:Date.now(),sessionId:"debug-session",runId:"run4",hypothesisId:"C"}};fetch("http://127.0.0.1:7243/ingest/b2719b1f-0fda-42ef-a1bf-85265994e0a0",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)}).catch(()=>{}),console.log("[Slop-Stop] Trash icon added to element:",{tagName:t.tagName,className:t.className?.substring(0,50),textLength:t.textContent?.length}),t.__slopTrashIcon=s};typeof window<"u"&&(window.addEventListener("unhandledrejection",t=>{let e=t.reason;e instanceof Error&&(e.message.includes("Extension context invalidated")||e.message.includes("message port closed")||e.message.includes("Receiving end does not exist")||e.message.includes("chrome-extension://invalid"))&&(t.preventDefault(),O())}),window.addEventListener("error",t=>{if(t.message&&t.message.includes("chrome-extension://invalid"))return t.preventDefault(),!1},!0));var nt=()=>{let t=ct(),e=async l=>{if(!N)return;console.log(`[Slop-Stop] handleNewItems called with ${l.length} items`);let o={location:"content-main.ts:569",message:"handleNewItems called",data:{itemsCount:l.length,items:l.slice(0,3).map(c=>({tagName:c.tagName,className:c.className?.substring(0,50),id:c.id?.substring(0,30)})),timestamp:Date.now(),sessionId:"debug-session",runId:"run3",hypothesisId:"A"}};fetch("http://127.0.0.1:7243/ingest/b2719b1f-0fda-42ef-a1bf-85265994e0a0",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}).catch(()=>{});for(let c=0;c<l.length;c++){let n=l[c];if(!N)break;let d=t.getItemId(n),h={location:"content-main.ts:582",message:"Processing item",data:{itemIndex:c,itemId:d,itemTagName:n.tagName,itemClassName:n.className?.substring(0,50),itemIdAttr:n.id?.substring(0,30),timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"C"}};if(fetch("http://127.0.0.1:7243/ingest/b2719b1f-0fda-42ef-a1bf-85265994e0a0",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)}).catch(()=>{}),!d){console.log("[Slop-Stop] Skipping item without ID:",{tagName:n.tagName,className:n.className?.substring(0,50),textLength:n.textContent?.length});let a={location:"content-main.ts:686",message:"Skipping item - no ID",data:{itemIndex:c,itemTagName:n.tagName,itemClassName:n.className?.substring(0,50),itemIdAttr:n.id?.substring(0,30),itemTextLength:n.textContent?.length,itemChildrenCount:n.children.length,timestamp:Date.now(),sessionId:"debug-session",runId:"run4",hypothesisId:"B"}};fetch("http://127.0.0.1:7243/ingest/b2719b1f-0fda-42ef-a1bf-85265994e0a0",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).catch(()=>{});continue}if(n.querySelector("[data-slop-trash-icon]")||document.querySelector('[data-slop-overlay="true"] [data-slop-trash-icon]')){console.log("[Slop-Stop] Trash icon already exists for item:",{itemId:d,tagName:n.tagName});let a={location:"content-main.ts:722",message:"Trash icon already exists",data:{itemId:d,itemTagName:n.tagName,timestamp:Date.now(),sessionId:"debug-session",runId:"run4",hypothesisId:"A"}};fetch("http://127.0.0.1:7243/ingest/b2719b1f-0fda-42ef-a1bf-85265994e0a0",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).catch(()=>{})}else try{console.log("[Slop-Stop] Adding trash icon to item:",{itemId:d,tagName:n.tagName,className:n.className?.substring(0,50),textLength:n.textContent?.length});let a={location:"content-main.ts:699",message:"About to call addTrashIconToItem",data:{itemId:d,itemTagName:n.tagName,itemClassName:n.className?.substring(0,50),itemIdAttr:n.id?.substring(0,30),itemTextLength:n.textContent?.length,itemChildrenCount:n.children.length,isConnected:n.isConnected,timestamp:Date.now(),sessionId:"debug-session",runId:"run4",hypothesisId:"A"}};fetch("http://127.0.0.1:7243/ingest/b2719b1f-0fda-42ef-a1bf-85265994e0a0",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).catch(()=>{}),ut(n,t);let u=n.querySelector("[data-slop-trash-icon]"),I={location:"content-main.ts:710",message:"After addTrashIconToItem call",data:{itemId:d,trashIconFound:!!u,trashIconInDOM:!!document.querySelector(`[data-slop-trash-icon][data-item-id="${d}"]`),itemTagName:n.tagName,timestamp:Date.now(),sessionId:"debug-session",runId:"run4",hypothesisId:"C"}};fetch("http://127.0.0.1:7243/ingest/b2719b1f-0fda-42ef-a1bf-85265994e0a0",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(I)}).catch(()=>{})}catch(a){console.error("[Slop-Stop] Error adding trash icon:",a);let u={location:"content-main.ts:714",message:"Error adding trash icon",data:{itemId:d,errorMessage:a instanceof Error?a.message:String(a),itemTagName:n.tagName,timestamp:Date.now(),sessionId:"debug-session",runId:"run4",hypothesisId:"A"}};fetch("http://127.0.0.1:7243/ingest/b2719b1f-0fda-42ef-a1bf-85265994e0a0",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)}).catch(()=>{})}let m=C.get(n),g=V.has(n),y=ot(d)!==null;if(!(g||y)&&(!m||!m.overlay&&!m.isShowing)){let a=!!m,u=m?!!m.overlay:!1,I=m?!!m.isShowing:!1,T={location:"content-main.ts:615",message:"About to processItem",data:{itemId:d,hasExistingItem:a,hasOverlay:u,isShowing:I,timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"A"}};fetch("http://127.0.0.1:7243/ingest/b2719b1f-0fda-42ef-a1bf-85265994e0a0",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(T)}).catch(()=>{}),V.add(n);try{await Y(n,t).catch(E=>{})}catch(E){if(E instanceof Error&&E.message.includes("Extension context invalidated")){O();break}}finally{V.delete(n)}}}},i=t.observeItems(e),r=new MutationObserver(l=>{if(!N)return;let o=[];C.forEach((c,n)=>{n.isConnected?c.overlay&&!c.overlay.parentNode?(c.overlay.__slopCleanup&&c.overlay.__slopCleanup(),c.isShowing=!0,c.overlay=null):c.overlay&&c.overlay.parentNode!==n&&!c.isShowing&&(c.overlay.__slopCleanup&&c.overlay.__slopCleanup(),c.overlay.parentNode&&c.overlay.parentNode.removeChild(c.overlay),o.push(n)):(c.overlay&&(c.overlay.__slopCleanup&&c.overlay.__slopCleanup(),c.overlay.parentNode&&c.overlay.parentNode.removeChild(c.overlay)),n.style&&(n.style.removeProperty("opacity"),n.style.removeProperty("visibility"),n.style.removeProperty("pointer-events"),n.style.removeProperty("position")),o.push(n))}),o.forEach(c=>{C.delete(c)}),document.querySelectorAll("[data-slop-overlay]").forEach(c=>{if(!Array.from(C.values()).some(d=>d.overlay===c)&&c.parentNode){let d=c.__createdAt||0;Date.now()-d>2e3&&c.parentNode.removeChild(c)}})});r.observe(document.body,{childList:!0,subtree:!0});let s=et(t,async(l,o)=>{let c={location:"content-main.ts:714",message:"onReportSlop called from hotkeys",data:{itemId:l,elementTagName:o.tagName,elementClassName:o.className?.substring(0,50),elementIdAttr:o.id?.substring(0,30),isConnected:o.isConnected,timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"D"}};if(fetch("http://127.0.0.1:7243/ingest/b2719b1f-0fda-42ef-a1bf-85265994e0a0",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)}).catch(()=>{}),!!N)try{try{await Q(l,t.getPlatformName())}catch{}N&&o&&o.isConnected&&await Y(o,t,!0).catch(()=>{})}catch{}},mt);window.addEventListener("beforeunload",()=>{i(),r.disconnect(),s()}),chrome.runtime.onMessage.addListener((l,o,c)=>{if(l.type==="KEYBOARD_COMMAND"){let n=l.command;if(n==="toggle-trash-mode"){let d=new KeyboardEvent("keydown",{key:"s",altKey:!0,ctrlKey:!1,metaKey:!1,bubbles:!0,cancelable:!0});document.dispatchEvent(d)}else if(n==="report-website"){let d=new KeyboardEvent("keydown",{key:"u",altKey:!0,ctrlKey:!1,metaKey:!1,bubbles:!0,cancelable:!0});document.dispatchEvent(d)}return c({success:!0}),!0}return!1})};try{let t=window.self!==window.top,e=window.location.href==="about:blank"||window.location.href==="about:srcdoc";t||e?console.log("[Slop-Stop] Content script skipped: running in iframe or sandboxed frame",{isInIframe:t,isAboutBlank:e,location:window.location.href}):document.readyState==="loading"?document.addEventListener("DOMContentLoaded",nt):nt()}catch(t){console.warn("[Slop-Stop] Error checking frame context, skipping initialization:",t)}})();
//# sourceMappingURL=content-main.js.map
